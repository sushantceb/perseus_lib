!function(){function t(){}function e(t){var e=t.length-1;return function(){var n=q.call(arguments,0,e),i=q.call(arguments,e);return t.apply(this,n.concat([i]))}}function n(t){return e(function(e,n){"function"!=typeof e&&(e=y(e));var i=function(t){return e.apply(t,[t].concat(n))};return t.call(this,i)})}function i(t){var e=q.call(arguments,1);return function(){return t.apply(this,e)}}function r(t,e){if(!e)throw new Error("prayer failed: "+t)}function s(t){r("a direction was passed",t===O||t===k)}function o(t,e,n){r("a parent is always present",t),r("leftward is properly set up",function(){return e?e[k]===n&&e.parent===t:t.ends[O]===n}()),r("rightward is properly set up",function(){return n?n[O]===e&&n.parent===t:t.ends[k]===e}())}function a(){window.console&&console.warn('You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')}function l(t){return a(),_t(t)}function c(e){function n(t){if(!t||!t.nodeType)return null;var e=j(t).children(".mq-root-block").attr(v),n=e&&C.byId[e].controller;return n?r[n.KIND_OF_MQ](n):null}function i(t,e){e&&e.handlers&&(e.handlers={fns:e.handlers,APIClasses:r});for(var n in e)if(e.hasOwnProperty(n)){var i=e[n],s=z[n];t[n]=s?s(i):i}}if(!(B<=e&&e<=F))throw"Only interface versions between "+B+" and "+F+" supported. You specified: "+e;var r={};n.L=O,n.R=k,n.config=function(t){return i(I.p,t),this},n.registerEmbed=function(t,e){if(!/^[a-z][a-z0-9]*$/i.test(t))throw"Embed name must start with letter and be only letters and digits";M[t]=e};var s=r.AbstractMathQuill=x(R,function(t){t.init=function(t){this.__controller=t,this.__options=t.options,this.id=t.id,this.data=t.data},t.__mathquillify=function(t){var e=this.__controller,n=e.root,i=e.container;e.createTextarea();var r=i.addClass(t).contents().detach();n.jQ=j('<span class="mq-root-block"/>').attr(v,n.id).appendTo(i),this.latex(r.text()),this.revert=function(){return i.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(r)}},t.config=function(t){return i(this.__options,t),this},t.el=function(){return this.__controller.container[0]},t.text=function(){return this.__controller.exportText()},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexMath(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},t.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},t.reflow=function(){return this.__controller.root.postOrder("reflow"),this}});n.prototype=s.prototype,r.EditableField=x(s,function(e,n){e.__mathquillify=function(){return n.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},e.focus=function(){return this.__controller.textarea.focus(),this},e.blur=function(){return this.__controller.textarea.blur(),this},e.write=function(t){return this.__controller.writeLatex(t),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},e.cmd=function(t){var e=this.__controller.notify(),n=e.cursor;if(/^\\[a-z]+$/i.test(t)){t=t.slice(1);var i=S[t];i&&(t=i(t),n.selection&&t.replaces(n.replaceSelection()),t.createLeftOf(n.show()),this.__controller.scrollHoriz())}else n.parent.write(n,t);return e.blurred&&n.hide().parent.blur(),this},e.select=function(){var t=this.__controller;for(t.notify("move").cursor.insAtRightEnd(t.root);t.cursor[O];)t.selectLeft();return this},e.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},e.moveToDirEnd=function(t){return this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root),this},e.moveToLeftEnd=function(){return this.moveToDirEnd(O)},e.moveToRightEnd=function(){return this.moveToDirEnd(k)},e.keystroke=function(e){for(var e=e.replace(/^\s+|\s+$/g,"").split(/\s+/),n=0;n<e.length;n+=1)this.__controller.keystroke(e[n],{preventDefault:t});return this},e.typedText=function(t){for(var e=0;e<t.length;e+=1)this.__controller.typedText(t.charAt(e));return this},e.dropEmbedded=function(t,e,n){var i=t-j(window).scrollLeft(),r=e-j(window).scrollTop(),s=document.elementFromPoint(i,r);this.__controller.seek(j(s),t,e);var o=Dt().setOptions(n);o.createLeftOf(this.__controller.cursor)}}),n.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},n.EditableField.prototype=r.EditableField.prototype;for(var o in L)(function(t,i){var s=r[t]=i(r);n[t]=function(i,r){var o=n(i);if(o instanceof s||!i||!i.nodeType)return o;var a=E(s.RootBlock(),j(i),I());return a.KIND_OF_MQ=t,s(a).__mathquillify(r,e)},n[t].prototype=s.prototype})(o,L[o]);return n}function u(t){for(var e="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" "),n=0;n<e.length;n+=1)(function(e){t[e]=function(t){this.controller.handle(e,t)}})(e[n]);t.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function h(t){var e=this.parent,n=t;do{if(n[k])return t.insLeftOf(e);n=n.parent.parent}while(n!==e);t.insRightOf(e)}function f(t,e){t.jQadd=function(){e.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},t.reflow=function(){var t=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));pt(this.delimjQs,b(1+.2*(t-1),1.2),1.2*t)}}function p(t,e){var e=e||t,n=Tt[t],r=Tt[e];D[t]=i(Ct,O,t,n,e,r),D[n]=i(Ct,k,t,n,e,r)}var d,m=window.jQuery,g="mathquill-command-id",v="mathquill-block-id",b=Math.min,w=Math.max,q=[].slice,y=e(function(t,n){return e(function(e,i){if(t in e)return e[t].apply(e,n.concat(i))})}),x=function(t,e,n){function i(t){return"object"==typeof t}function r(t){return"function"==typeof t}function s(){}return function o(a,l){function c(){var t=new u;return r(t.init)&&t.init.apply(t,arguments),t}function u(){}l===n&&(l=a,a=Object),c.Bare=u;var h,f=s[t]=a[t],p=u[t]=c[t]=c.p=new s;return p.constructor=c,c.mixin=function(e){return u[t]=c[t]=o(c,e)[t],c},(c.open=function(t){if(h={},r(t)?h=t.call(c,p,f,c,a):i(t)&&(h=t),i(h))for(var n in h)e.call(h,n)&&(p[n]=h[n]);return r(p.init)||(p.init=a),c})(l)}}("prototype",{}.hasOwnProperty),O=-1,k=1,j=x(m,function(t){t.insDirOf=function(t,e){return t===O?this.insertBefore(e.first()):this.insertAfter(e.last())},t.insAtDirEnd=function(t,e){return t===O?this.prependTo(e):this.appendTo(e)}}),Q=x(function(t){t.parent=0,t[O]=0,t[k]=0,t.init=function(t,e,n){this.parent=t,this[O]=e,this[k]=n},this.copy=function(t){return Q(t.parent,t[O],t[k])}}),C=x(function(t){function e(){return i+=1}t[O]=0,t[k]=0,t.parent=0;var i=0;this.byId={},t.init=function(){this.id=e(),C.byId[this.id]=this,this.ends={},this.ends[O]=0,this.ends[k]=0},t.dispose=function(){delete C.byId[this.id]},t.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},t.jQ=j(),t.jQadd=function(t){return this.jQ=this.jQ.add(t)},t.jQize=function(t){function e(t){if(t.getAttribute){var n=t.getAttribute("mathquill-command-id"),i=t.getAttribute("mathquill-block-id");n&&C.byId[n].jQadd(t),i&&C.byId[i].jQadd(t)}for(t=t.firstChild;t;t=t.nextSibling)e(t)}for(var t=j(t||this.html()),n=0;n<t.length;n+=1)e(t[n]);return t},t.createDir=function(t,e){s(t);var n=this;return n.jQize(),n.jQ.insDirOf(t,e.jQ),e[t]=n.adopt(e.parent,e[O],e[k]),n},t.createLeftOf=function(t){return this.createDir(O,t)},t.selectChildren=function(t,e){return A(t,e)},t.bubble=n(function(t){for(var e=this;e;e=e.parent){var n=t(e);if(n===!1)break}return this}),t.postOrder=n(function(t){return function e(n){n.eachChild(e),t(n)}(this),this}),t.isEmpty=function(){return 0===this.ends[O]&&0===this.ends[k]},t.children=function(){return T(this.ends[O],this.ends[k])},t.eachChild=function(){var t=this.children();return t.each.apply(t,arguments),this},t.foldChildren=function(t,e){return this.children().fold(t,e)},t.withDirAdopt=function(t,e,n,i){return T(this,this).withDirAdopt(t,e,n,i),this},t.adopt=function(t,e,n){return T(this,this).adopt(t,e,n),this},t.disown=function(){return T(this,this).disown(),this},t.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}),T=x(function(t){t.init=function(t,e,n){if(n===d&&(n=O),s(n),r("no half-empty fragments",!t==!e),this.ends={},t){r("withDir is passed to Fragment",t instanceof C),r("oppDir is passed to Fragment",e instanceof C),r("withDir and oppDir have the same parent",t.parent===e.parent),this.ends[n]=t,this.ends[-n]=e;var i=this.fold([],function(t,e){return t.push.apply(t,e.jQ.get()),t});this.jQ=this.jQ.add(i)}},t.jQ=j(),t.withDirAdopt=function(t,e,n,i){return t===O?this.adopt(e,n,i):this.adopt(e,i,n)},t.adopt=function(t,e,n){o(t,e,n);var i=this;i.disowned=!1;var r=i.ends[O];if(!r)return this;var s=i.ends[k];return e||(t.ends[O]=r),n?n[O]=s:t.ends[k]=s,i.ends[k][k]=n,i.each(function(n){n[O]=e,n.parent=t,e&&(e[k]=n),e=n}),i},t.disown=function(){var t=this,e=t.ends[O];if(!e||t.disowned)return t;t.disowned=!0;var n=t.ends[k],i=e.parent;return o(i,e[O],e),o(i,n,n[k]),e[O]?e[O][k]=n[k]:i.ends[O]=n[k],n[k]?n[k][O]=e[O]:i.ends[k]=e[O],t},t.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},t.each=n(function(t){var e=this,n=e.ends[O];if(!n)return e;for(;n!==e.ends[k][k];n=n[k]){var i=t(n);if(i===!1)break}return e}),t.fold=function(t,e){return this.each(function(n){t=e.call(this,t,n)}),t}}),S={},D={},_=x(Q,function(t){t.init=function(t,e){this.parent=t,this.options=e;var n=this.jQ=this._jQ=j('<span class="mq-cursor">&#8203;</span>');this.blink=function(){n.toggleClass("mq-blink")},this.upDownCache={}},t.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[k]?this.selection&&this.selection.ends[O][O]===this[O]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[k].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},t.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=j(),this},t.withDirInsertAt=function(t,e,n,i){var r=this.parent;this.parent=e,this[t]=n,this[-t]=i,r!==e&&r.blur&&r.blur(this)},t.insDirOf=function(t,e){return s(t),this.jQ.insDirOf(t,e.jQ),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.jQ.addClass("mq-hasCursor"),this},t.insLeftOf=function(t){return this.insDirOf(O,t)},t.insRightOf=function(t){return this.insDirOf(k,t)},t.insAtDirEnd=function(t,e){return s(t),this.jQ.insAtDirEnd(t,e.jQ),this.withDirInsertAt(t,e,0,e.ends[t]),e.focus(),this},t.insAtLeftEnd=function(t){return this.insAtDirEnd(O,t)},t.insAtRightEnd=function(t){return this.insAtDirEnd(k,t)},t.jumpUpDown=function(t,e){var n=this;n.upDownCache[t.id]=Q.copy(n);var i=n.upDownCache[e.id];if(i)i[k]?n.insLeftOf(i[k]):n.insAtRightEnd(i.parent);else{var r=n.offset().left;e.seek(r,n)}},t.offset=function(){var t=this,e=t.jQ.removeClass("mq-cursor").offset();return t.jQ.addClass("mq-cursor"),e},t.unwrapGramp=function(){var t=this.parent.parent,e=t.parent,n=t[k],i=this,r=t[O];if(t.disown().eachChild(function(i){i.isEmpty()||(i.children().adopt(e,r,n).each(function(e){e.jQ.insertBefore(t.jQ.first())}),r=i.ends[k])}),!this[k])if(this[O])this[k]=this[O][k];else for(;!this[k];){if(this.parent=this.parent[k],!this.parent){this[k]=t[k],this.parent=e;break}this[k]=this.parent.ends[O]}this[k]?this.insLeftOf(this[k]):this.insAtRightEnd(e),t.jQ.remove(),t[O].siblingDeleted&&t[O].siblingDeleted(i.options,k),t[k].siblingDeleted&&t[k].siblingDeleted(i.options,O)},t.startSelection=function(){for(var t=this.anticursor=Q.copy(this),e=t.ancestors={},n=t;n.parent;n=n.parent)e[n.parent.id]=n},t.endSelection=function(){delete this.anticursor},t.select=function(){var t=this.anticursor;if(this[O]===t[O]&&this.parent===t.parent)return!1;for(var e=this;e.parent;e=e.parent)if(e.parent.id in t.ancestors){var n=e.parent;break}r("cursor and anticursor in the same tree",n);var i,s,o=t.ancestors[n.id],a=k;if(e[O]!==o)for(var l=e;l;l=l[k])if(l[k]===o[k]){a=O,i=e,s=o;break}return a===k&&(i=o,s=e),i instanceof Q&&(i=i[k]),s instanceof Q&&(s=s[O]),this.hide().selection=n.selectChildren(i,s),this.insDirOf(a,this.selection.ends[a]),this.selectionChanged(),!0},t.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},t.deleteSelection=function(){this.selection&&(this[O]=this.selection.ends[O][O],this[k]=this.selection.ends[k][k],this.selection.remove(),this.selectionChanged(),delete this.selection)},t.replaceSelection=function(){var t=this.selection;return t&&(this[O]=t.ends[O][O],this[k]=t.ends[k][k],delete this.selection),t}}),A=x(T,function(t,e){t.init=function(){e.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},t.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),e.adopt.apply(this,arguments)},t.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},t.join=function(t){return this.fold("",function(e,n){return e+n[t]()})}}),E=x(function(t){t.init=function(t,e,n){this.id=t.id,this.data={},this.root=t,this.container=e,this.options=n,t.controller=this,this.cursor=t.cursor=_(t,n)},t.handle=function(t,e){var n=this.options.handlers;if(n&&n.fns[t]){var i=n.APIClasses[this.KIND_OF_MQ](this);e===O||e===k?n.fns[t](e,i):n.fns[t](i)}};var e=[];this.onNotify=function(t){e.push(t)},t.notify=function(){for(var t=0;t<e.length;t+=1)e[t].apply(this.cursor,arguments);return this}}),L={},I=x(),z={},R=x(),M={};l.prototype=R.p,l.interfaceVersion=function(t){if(1!==t)throw"Only interface version 1 supported. You specified: "+t;return a=function(){window.console&&console.warn('You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')},a(),l},l.getInterface=c;var B=c.MIN=1,F=c.MAX=2;l.noConflict=function(){return window.MathQuill=N,l};var N=window.MathQuill;window.MathQuill=l;var $=x(function(t,e,n){function i(t,e){throw t=t?"'"+t+"'":"EOF","Parse Error: "+e+" at "+t}t.init=function(t){this._=t},t.parse=function(t){function e(t,e){return e}return this.skip(a)._(""+t,e,i)},t.or=function(t){r("or is passed a parser",t instanceof n);var e=this;return n(function(n,i,r){function s(e){return t._(n,i,r)}return e._(n,i,s)})},t.then=function(t){var e=this;return n(function(i,s,o){function a(e,i){var a=t instanceof n?t:t(i);return r("a parser is returned",a instanceof n),a._(e,s,o)}return e._(i,a,o)})},t.many=function(){var t=this;return n(function(e,n,i){function r(t,n){return e=t,o.push(n),!0}function s(){return!1}for(var o=[];t._(e,r,s););return n(e,o)})},t.times=function(t,e){arguments.length<2&&(e=t);var i=this;return n(function(n,r,s){function o(t,e){return u.push(e),n=t,!0}function a(t,e){return c=e,n=t,!1}function l(t,e){return!1}for(var c,u=[],h=!0,f=0;f<t;f+=1)if(h=i._(n,o,a),!h)return s(n,c);for(;f<e&&h;f+=1)h=i._(n,o,l);return r(n,u)})},t.result=function(t){return this.then(o(t))},t.atMost=function(t){return this.times(0,t)},t.atLeast=function(t){var e=this;return e.times(t).then(function(t){return e.many().map(function(e){return t.concat(e)})})},t.map=function(t){return this.then(function(e){return o(t(e))})},t.skip=function(t){return this.then(function(e){return t.result(e)})};var s=(this.string=function(t){var e=t.length,i="expected '"+t+"'";return n(function(n,r,s){var o=n.slice(0,e);return o===t?r(n.slice(e),o):s(n,i)})},this.regex=function(t){r("regexp parser is anchored","^"===t.toString().charAt(1));var e="expected "+t;return n(function(n,i,r){var s=t.exec(n);if(s){var o=s[0];return i(n.slice(o.length),o)}return r(n,e)})}),o=n.succeed=function(t){return n(function(e,n){return n(e,t)})},a=(n.fail=function(t){return n(function(e,n,i){return i(e,t)})},n.letter=s(/^[a-z]/i),n.letters=s(/^[a-z]*/i),n.digit=s(/^[0-9]/),n.digits=s(/^[0-9]*/),n.whitespace=s(/^\s+/),n.optWhitespace=s(/^\s*/),n.any=n(function(t,e,n){return t?e(t.slice(1),t.charAt(0)):n(t,"expected any character")}),n.all=n(function(t,e,n){return e("",t)}),n.eof=n(function(t,e,n){return t?n(t,"expected EOF"):e(t,t)}))}),P=function(){function e(t){var e,i=t.which||t.keyCode,r=n[i],s=[];return t.ctrlKey&&s.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&s.push("Meta"),t.altKey&&s.push("Alt"),t.shiftKey&&s.push("Shift"),e=r||String.fromCharCode(i),s.length||r?(s.push(e),s.join("-")):e}var n={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(n,i){function r(t){q=t,clearTimeout(d),d=setTimeout(t)}function s(e){q(),q=t,clearTimeout(d),b.val(e),e&&b[0].select&&b[0].select(),y=!!e}function o(){var t=b[0];return"selectionStart"in t&&t.selectionStart!==t.selectionEnd}function a(){i.keystroke(e(g),g)}function l(e){g=e,v=null,y&&r(function(e){e&&"focusout"===e.type||!b[0].select||b[0].select(),q=t,clearTimeout(d)}),a()}function c(t){g&&v&&a(),v=t,r(u)}function u(){if(!o()){var t=b.val();1===t.length?(b.val(""),i.typedText(t)):t&&b[0].select&&b[0].select()}}function h(){g=v=null}function f(t){b.focus(),r(p)}function p(){var t=b.val();b.val(""),t&&i.paste(t)}var d,g=null,v=null,b=m(n),w=m(i.container||b),q=t;w.bind("keydown keypress input keyup focusout paste",function(t){q(t)});var y=!1;return w.bind({keydown:l,keypress:c,focusout:h,paste:f}),{select:s}}}();E.open(function(t,e){t.exportText=function(){return this.root.foldChildren("",function(t,e){return t+e.text()})}}),E.open(function(t){t.focusBlurEvents=function(){function t(){clearTimeout(n),s.selection&&s.selection.jQ.addClass("mq-blur"),e()}function e(){s.hide().parent.blur(),i.container.removeClass("mq-focused"),j(window).off("blur",t)}var n,i=this,r=i.root,s=i.cursor;i.textarea.focus(function(){i.blurred=!1,clearTimeout(n),i.container.addClass("mq-focused"),s.parent||s.insAtRightEnd(r),s.selection?(s.selection.jQ.removeClass("mq-blur"),i.selectionChanged()):s.show()}).blur(function(){i.blurred=!0,n=setTimeout(function(){r.postOrder("intentionalBlur"),s.clearSelection().endSelection(),e()}),j(window).on("blur",t)}),i.blurred=!0,s.hide().parent.blur()}}),E.open(function(t){t.keystroke=function(t,e){this.cursor.parent.keystroke(t,e,this)}}),C.open(function(t){t.keystroke=function(t,e,n){var i=n.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":n.ctrlDeleteDir(O);break;case"Shift-Backspace":case"Backspace":n.backspace();break;case"Esc":case"Tab":return void n.escapeDir(k,t,e);case"Shift-Tab":case"Shift-Esc":return void n.escapeDir(O,t,e);case"End":n.notify("move").cursor.insAtRightEnd(i.parent);break;case"Ctrl-End":n.notify("move").cursor.insAtRightEnd(n.root);break;case"Shift-End":for(;i[k];)n.selectRight();break;case"Ctrl-Shift-End":for(;i[k]||i.parent!==n.root;)n.selectRight();break;case"Home":n.notify("move").cursor.insAtLeftEnd(i.parent);break;case"Ctrl-Home":n.notify("move").cursor.insAtLeftEnd(n.root);break;case"Shift-Home":for(;i[O];)n.selectLeft();break;case"Ctrl-Shift-Home":for(;i[O]||i.parent!==n.root;)n.selectLeft();break;case"Left":n.moveLeft();break;case"Shift-Left":n.selectLeft();break;case"Ctrl-Left":break;case"Right":n.moveRight();break;case"Shift-Right":n.selectRight();break;case"Ctrl-Right":break;case"Up":n.moveUp();break;case"Down":n.moveDown();break;case"Shift-Up":if(i[O])for(;i[O];)n.selectLeft();else n.selectLeft();case"Shift-Down":if(i[k])for(;i[k];)n.selectRight();else n.selectRight();case"Ctrl-Up":break;case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":n.ctrlDeleteDir(k);break;case"Shift-Del":case"Del":n.deleteForward();break;case"Meta-A":case"Ctrl-A":for(n.notify("move").cursor.insAtRightEnd(n.root);i[O];)n.selectLeft();break;default:return}e.preventDefault(),n.scrollHoriz()},t.moveOutOf=t.moveTowards=t.deleteOutOf=t.deleteTowards=t.unselectInto=t.selectOutOf=t.selectTowards=function(){r("overridden or never called on this node")}}),E.open(function(t){function e(t,e){var n=t.notify("upDown").cursor,i=e+"Into",r=e+"OutOf";return n[k][i]?n.insAtLeftEnd(n[k][i]):n[O][i]?n.insAtRightEnd(n[O][i]):n.parent.bubble(function(t){var e=t[r];if(e&&("function"==typeof e&&(e=t[r](n)),e instanceof C&&n.jumpUpDown(t,e),e!==!0))return!1}),t}this.onNotify(function(t){"move"!==t&&"upDown"!==t||this.show().clearSelection()}),t.escapeDir=function(t,e,n){s(t);var i=this.cursor;if(i.parent!==this.root&&n.preventDefault(),i.parent!==this.root)return i.parent.moveOutOf(t,i),this.notify("move")},z.leftRightIntoCmdGoes=function(t){if(t&&"up"!==t&&"down"!==t)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+t+'"';return t},t.moveDir=function(t){s(t);var e=this.cursor,n=e.options.leftRightIntoCmdGoes;return e.selection?e.insDirOf(t,e.selection.ends[t]):e[t]?e[t].moveTowards(t,e,n):e.parent.moveOutOf(t,e,n),this.notify("move")},t.moveLeft=function(){return this.moveDir(O)},t.moveRight=function(){return this.moveDir(k)},t.moveUp=function(){return e(this,"up")},t.moveDown=function(){return e(this,"down")},this.onNotify(function(t){"upDown"!==t&&(this.upDownCache={})}),this.onNotify(function(t){"edit"===t&&this.show().deleteSelection()}),t.deleteDir=function(t){s(t);var e=this.cursor,n=e.selection;return this.notify("edit"),n||(e[t]?e[t].deleteTowards(t,e):e.parent.deleteOutOf(t,e)),e[O].siblingDeleted&&e[O].siblingDeleted(e.options,k),e[k].siblingDeleted&&e[k].siblingDeleted(e.options,O),e.parent.bubble("reflow"),this},t.ctrlDeleteDir=function(t){s(t);var e=this.cursor;return!e[O]||e.selection?ctrlr.deleteDir():(this.notify("edit"),T(e.parent.ends[O],e[O]).remove(),e.insAtDirEnd(O,e.parent),e[O].siblingDeleted&&e[O].siblingDeleted(e.options,k),e[k].siblingDeleted&&e[k].siblingDeleted(e.options,O),e.parent.bubble("reflow"),this)},t.backspace=function(){return this.deleteDir(O)},t.deleteForward=function(){return this.deleteDir(k)},this.onNotify(function(t){"select"!==t&&this.endSelection()}),t.selectDir=function(t){var e=this.notify("select").cursor,n=e.selection;s(t),e.anticursor||e.startSelection();var i=e[t];i?n&&n.ends[t]===i&&e.anticursor[-t]!==i?i.unselectInto(t,e):i.selectTowards(t,e):e.parent.selectOutOf(t,e),e.clearSelection(),e.select()||e.show()},t.selectLeft=function(){return this.selectDir(O)},t.selectRight=function(){return this.selectDir(k)}});var U=function(){function t(t){var e=X();return t.adopt(e,0,0),e}function e(t){for(var e=t[0]||X(),n=1;n<t.length;n+=1)t[n].children().adopt(e,e.ends[k],0);return e}var n=$.string,i=$.regex,r=$.letter,s=$.any,o=$.optWhitespace,a=$.succeed,l=$.fail,c=r.map(function(t){return tt(t)}),u=i(/^[^${}\\_^]/).map(function(t){return K(t)}),h=i(/^[^\\a-eg-zA-Z]/).or(n("\\").then(i(/^[a-z]+/i).or(i(/^\s+/).result(" ")).or(s))).then(function(t){var e=S[t];return e?e(t).parser():l("unknown command: \\"+t)}),f=h.or(c).or(u),p=n("{").then(function(){return m}).skip(n("}")),d=o.then(p.or(f.map(t))),m=d.many().map(e).skip(o),g=n("[").then(d.then(function(t){return"]"!==t.join("latex")?a(t):l()}).many().map(e).skip(o)).skip(n("]")),v=m;return v.block=d,v.optBlock=g,v}();E.open(function(t,e){t.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},t.writeLatex=function(t){var e=this.notify("edit").cursor,n=$.all,i=$.eof,r=U.skip(i).or(n.result(!1)).parse(t);if(r&&!r.isEmpty()){r.children().adopt(e.parent,e[O],e[k]);var s=r.jQize();s.insertBefore(e.jQ),e[O]=r.ends[k],r.finalizeInsert(e.options,e),r.ends[k][k].siblingCreated&&r.ends[k][k].siblingCreated(e.options,O),r.ends[O][O].siblingCreated&&r.ends[O][O].siblingCreated(e.options,k),e.parent.bubble("reflow")}return this},t.renderLatexMath=function(t){var e=this.root,n=this.cursor,i=$.all,r=$.eof,s=U.skip(r).or(i.result(!1)).parse(t);e.eachChild("postOrder","dispose"),e.ends[O]=e.ends[k]=0,s&&s.children().adopt(e,0,0);var o=e.jQ;if(s){var a=s.join("html");o.html(a),e.jQize(o.children()),e.finalizeInsert(n.options)}else o.empty();delete n.selection,n.insAtRightEnd(e)},t.renderLatexText=function(t){var e=this.root,n=this.cursor;e.jQ.children().slice(1).remove(),e.eachChild("postOrder","dispose"),e.ends[O]=e.ends[k]=0,delete n.selection,n.show().insAtRightEnd(e);var i=$.regex,r=$.string,s=$.eof,o=$.all,a=r("$").then(U).skip(r("$").or(s)).map(function(t){var e=RootMathCommand(n);e.createBlocks();var i=e.ends[O];return t.children().adopt(i,0,0),e}),l=r("\\$").result("$"),c=l.or(i(/^[^$]/)).map(K),u=a.or(c).many(),h=u.skip(s).or(o.result(!1)).parse(t);if(h){for(var f=0;f<h.length;f+=1)h[f].adopt(e,e.ends[k],0);e.jQize().appendTo(e.jQ),e.finalizeInsert(n.options)}}}),E.open(function(e){e.delegateMouseEvents=function(){var e=this.root.jQ;this.container.bind("mousedown.mathquill",function(n){function i(t){o=j(t.target)}function r(t){u.anticursor||u.startSelection(),c.seek(o,t.pageX,t.pageY).cursor.select(),o=d}function s(t){u.blink=h,u.selection||(c.editable?u.show():f.detach()),a.unbind("mousemove",i),j(t.target.ownerDocument).unbind("mousemove",r).unbind("mouseup",s)}var o,a=j(n.target).closest(".mq-root-block"),l=C.byId[a.attr(v)||e.attr(v)],c=l.controller,u=c.cursor,h=u.blink,f=c.textareaSpan,p=c.textarea;c.blurred&&(c.editable||a.prepend(f),p.focus()),n.preventDefault(),n.target.unselectable=!0,u.blink=t,c.seek(j(n.target),n.pageX,n.pageY).cursor.startSelection(),a.mousemove(i),j(n.target.ownerDocument).mousemove(r).mouseup(s)})}}),E.open(function(t){t.seek=function(t,e,n){var i=this.notify("select").cursor;if(t){var s=t.attr(v)||t.attr(g);if(!s){var o=t.parent();s=o.attr(v)||o.attr(g)}}var a=s?C.byId[s]:this.root;return r("nodeId is the id of some Node that exists",a),i.clearSelection().show(),a.seek(e,i),this.scrollHoriz(),this}}),E.open(function(t){t.scrollHoriz=function(){var t=this.cursor,e=t.selection,n=this.root.jQ[0].getBoundingClientRect();if(e){var i=e.jQ[0].getBoundingClientRect(),r=i.left-(n.left+20),s=i.right-(n.right-20);if(e.ends[O]===t[k])if(r<0)var o=r;else{if(!(s>0))return;if(i.left-s<n.left+20)var o=r;else var o=s}else if(s>0)var o=s;else{if(!(r<0))return;if(i.right-r>n.right-20)var o=s;else var o=r}}else{var a=t.jQ[0].getBoundingClientRect().left;if(a>n.right-20)var o=a-(n.right-20);else{if(!(a<n.left+20))return;var o=a-(n.left+20)}}this.root.jQ.stop().animate({scrollLeft:"+="+o},100)}}),E.open(function(t){I.p.substituteTextarea=function(){return j("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},t.createTextarea=function(){var t=this.textareaSpan=j('<span class="mq-textarea"></span>'),e=this.options.substituteTextarea();if(!e.nodeType)throw"substituteTextarea() must return a DOM element, got "+e;e=this.textarea=j(e).appendTo(t);var n=this;n.cursor.selectionChanged=function(){n.selectionChanged()},n.container.bind("copy",function(){n.setTextareaSelection()})},t.selectionChanged=function(){var t=this;mt(t.container[0]),t.textareaSelectionTimeout===d&&(t.textareaSelectionTimeout=setTimeout(function(){t.setTextareaSelection()}))},t.setTextareaSelection=function(){this.textareaSelectionTimeout=d;var t="";this.cursor.selection&&(t=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(t="$"+t+"$")),this.selectFn(t)},t.staticMathTextareaEvents=function(){function t(){r.detach(),e.blurred=!0}var e=this,n=(e.root,e.cursor),i=e.textarea,r=e.textareaSpan;this.container.prepend('<span class="mq-selectable">$'+e.exportLatex()+"$</span>"),e.blurred=!0,i.bind("cut paste",!1).focus(function(){e.blurred=!1}).blur(function(){n.selection&&n.selection.clear(),setTimeout(t)}),e.selectFn=function(t){i.val(t),t&&i.select()}},t.editablesTextareaEvents=function(){var t=this,e=(t.root,t.cursor),n=t.textarea,i=t.textareaSpan,r=P(n,this);this.selectFn=function(t){r.select(t)},this.container.prepend(i).on("cut",function(n){e.selection&&setTimeout(function(){t.notify("edit"),e.parent.bubble("reflow")})}),this.focusBlurEvents()},t.typedText=function(t){if("\n"===t)return this.handle("enter");var e=this.notify().cursor;e.parent.write(e,t),this.scrollHoriz()},t.paste=function(t){this.options.statelessClipboard&&(t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}"),this.writeLatex(t).cursor.show()}});var H=x(C,function(t,e){t.finalizeInsert=function(t,e){var n=this;n.postOrder("finalizeTree",t),n.postOrder("contactWeld",e),n.postOrder("blur"),n.postOrder("reflow"),n[k].siblingCreated&&n[k].siblingCreated(t,O),n[O].siblingCreated&&n[O].siblingCreated(t,k),n.bubble("reflow")}}),W=x(H,function(t,e){t.init=function(t,n,i){var r=this;e.init.call(r),r.ctrlSeq||(r.ctrlSeq=t),n&&(r.htmlTemplate=n),i&&(r.textTemplate=i)},t.replaces=function(t){t.disown(),this.replacedFragment=t},t.isEmpty=function(){return this.foldChildren(!0,function(t,e){return t&&e.isEmpty()})},t.parser=function(){var t=U.block,e=this;return t.times(e.numBlocks()).map(function(t){e.blocks=t;for(var n=0;n<t.length;n+=1)t[n].adopt(e,e.ends[k],0);return e})},t.createLeftOf=function(t){var n=this,i=n.replacedFragment;n.createBlocks(),e.createLeftOf.call(n,t),i&&(i.adopt(n.ends[O],0,0),i.jQ.appendTo(n.ends[O].jQ)),n.finalizeInsert(t.options),n.placeCursor(t)},t.createBlocks=function(){for(var t=this,e=t.numBlocks(),n=t.blocks=Array(e),i=0;i<e;i+=1){var r=n[i]=X();r.adopt(t,t.ends[k],0)}},t.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[O],function(t,e){return t.isEmpty()?t:e}))},t.moveTowards=function(t,e,n){var i=n&&this[n+"Into"];e.insAtDirEnd(-t,i||this.ends[-t])},t.deleteTowards=function(t,e){this.isEmpty()?e[t]=this.remove()[t]:this.moveTowards(t,e,null)},t.selectTowards=function(t,e){e[-t]=this,e[t]=this[t]},t.selectChildren=function(){return A(this,this)},t.unselectInto=function(t,e){e.insAtDirEnd(-t,e.anticursor.ancestors[this.id])},t.seek=function(t,e){function n(t){var e={};return e[O]=t.jQ.offset().left,e[k]=e[O]+t.jQ.outerWidth(),e}var i=this,r=n(i);if(t<r[O])return e.insLeftOf(i);if(t>r[k])return e.insRightOf(i);var s=r[O];i.eachChild(function(o){var a=n(o);return t<a[O]?(t-s<a[O]-t?o[O]?e.insAtRightEnd(o[O]):e.insLeftOf(i):e.insAtLeftEnd(o),!1):t>a[k]?void(o[k]?s=a[k]:r[k]-t<t-a[k]?e.insRightOf(i):e.insAtRightEnd(o)):(o.seek(t,e),!1)})},t.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},t.html=function(){var t=this,e=t.blocks,n=" mathquill-command-id="+t.id,i=t.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);r("no unmatched angle brackets",i.join("")===this.htmlTemplate);for(var s=0,o=i[0];o;s+=1,o=i[s])if("/>"===o.slice(-2))i[s]=o.slice(0,-2)+n+"/>";else if("<"===o.charAt(0)){r("not an unmatched top-level close tag","/"!==o.charAt(1)),i[s]=o.slice(0,-1)+n+">";var a=1;do s+=1,o=i[s],r("no missing close tags",o),"</"===o.slice(0,2)?a-=1:"<"===o.charAt(0)&&"/>"!==o.slice(-2)&&(a+=1);while(a>0)}return i.join("").replace(/>&(\d+)/g,function(t,n){return" mathquill-block-id="+e[n].id+">"+e[n].join("html")})},t.latex=function(){return this.foldChildren(this.ctrlSeq,function(t,e){return t+"{"+(e.latex()||" ")+"}"})},t.textTemplate=[""],t.text=function(){var t=this,e=0;return t.foldChildren(t.textTemplate[e],function(n,i){
e+=1;var r=i.text();return n&&"("===t.textTemplate[e]&&"("===r[0]&&")"===r.slice(-1)?n+r.slice(1,-1)+t.textTemplate[e]:n+i.text()+(t.textTemplate[e]||"")})}}),G=x(W,function(e,n){e.init=function(t,e,i){i||(i=t&&t.length>1?t.slice(1):t),n.init.call(this,t,e,[i])},e.parser=function(){return $.succeed(this)},e.numBlocks=function(){return 0},e.replaces=function(t){t.remove()},e.createBlocks=t,e.moveTowards=function(t,e){e.jQ.insDirOf(t,this.jQ),e[-t]=this,e[t]=this[t]},e.deleteTowards=function(t,e){e[t]=this.remove()[t]},e.seek=function(t,e){t-this.jQ.offset().left<this.jQ.outerWidth()/2?e.insLeftOf(this):e.insRightOf(this)},e.latex=function(){return this.ctrlSeq},e.text=function(){return this.textTemplate},e.placeCursor=t,e.isEmpty=function(){return!0}}),K=x(G,function(t,e){t.init=function(t,n){e.init.call(this,t,"<span>"+(n||t)+"</span>")}}),Y=x(G,function(t,e){t.init=function(t,n,i){e.init.call(this,t,'<span class="mq-binary-operator">'+n+"</span>",i)}}),X=x(H,function(t,e){t.join=function(t){return this.foldChildren("",function(e,n){return e+n[t]()})},t.html=function(){return this.join("html")},t.latex=function(){return this.join("latex")},t.text=function(){return this.ends[O]===this.ends[k]&&0!==this.ends[O]?this.ends[O].text():this.join("text")},t.keystroke=function(t,n,i){return!i.options.spaceBehavesLikeTab||"Spacebar"!==t&&"Shift-Spacebar"!==t?e.keystroke.apply(this,arguments):(n.preventDefault(),void i.escapeDir("Shift-Spacebar"===t?O:k,t,n))},t.moveOutOf=function(t,e,n){var i=n&&this.parent[n+"Into"];!i&&this[t]?e.insAtDirEnd(-t,this[t]):e.insDirOf(t,this.parent)},t.selectOutOf=function(t,e){e.insDirOf(t,this.parent)},t.deleteOutOf=function(t,e){e.unwrapGramp()},t.seek=function(t,e){var n=this.ends[k];if(!n||n.jQ.offset().left+n.jQ.outerWidth()<t)return e.insAtRightEnd(this);if(t<this.ends[O].jQ.offset().left)return e.insAtLeftEnd(this);for(;t<n.jQ.offset().left;)n=n[O];return n.seek(t,e)},t.chToCmd=function(t){var e;return t.match(/^[a-eg-zA-Z]$/)?tt(t):/^\d$/.test(t)?V(t):(e=D[t]||S[t])?e(t):K(t)},t.write=function(t,e){var n=this.chToCmd(e);t.selection&&n.replaces(t.replaceSelection()),n.createLeftOf(t.show())},t.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},t.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}});L.StaticMath=function(t){return x(t.AbstractMathQuill,function(e,n){this.RootBlock=X,e.__mathquillify=function(){return n.__mathquillify.call(this,"mq-math-mode"),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents(),this},e.init=function(){n.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField)},e.latex=function(){var e=n.latex.apply(this,arguments);return arguments.length>0&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField),e}})};var Z=x(X,u);L.MathField=function(e){return x(e.EditableField,function(e,n){this.RootBlock=Z,e.__mathquillify=function(e,i){return this.config(e),i>1&&(this.__controller.root.reflow=t),n.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}})},S.notin=S.cong=S.equiv=S.oplus=S.otimes=x(Y,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),S["≠"]=S.ne=S.neq=i(Y,"\\ne ","&ne;"),S.ast=S.star=S.loast=S.lowast=i(Y,"\\ast ","&lowast;"),S.therefor=S.therefore=i(Y,"\\therefore ","&there4;"),S.cuz=S.because=i(Y,"\\because ","&#8757;"),S.prop=S.propto=i(Y,"\\propto ","&prop;"),S["≈"]=S.asymp=S.approx=i(Y,"\\approx ","&asymp;"),S.isin=S.in=i(Y,"\\in ","&isin;"),S.ni=S.contains=i(Y,"\\ni ","&ni;"),S.notni=S.niton=S.notcontains=S.doesnotcontain=i(Y,"\\not\\ni ","&#8716;"),S.sub=S.subset=i(Y,"\\subset ","&sub;"),S.sup=S.supset=S.superset=i(Y,"\\supset ","&sup;"),S.nsub=S.notsub=S.nsubset=S.notsubset=i(Y,"\\not\\subset ","&#8836;"),S.nsup=S.notsup=S.nsupset=S.notsupset=S.nsuperset=S.notsuperset=i(Y,"\\not\\supset ","&#8837;"),S.sube=S.subeq=S.subsete=S.subseteq=i(Y,"\\subseteq ","&sube;"),S.supe=S.supeq=S.supsete=S.supseteq=S.supersete=S.superseteq=i(Y,"\\supseteq ","&supe;"),S.nsube=S.nsubeq=S.notsube=S.notsubeq=S.nsubsete=S.nsubseteq=S.notsubsete=S.notsubseteq=i(Y,"\\not\\subseteq ","&#8840;"),S.nsupe=S.nsupeq=S.notsupe=S.notsupeq=S.nsupsete=S.nsupseteq=S.notsupsete=S.notsupseteq=S.nsupersete=S.nsuperseteq=S.notsupersete=S.notsuperseteq=i(Y,"\\not\\supseteq ","&#8841;"),S.N=S.naturals=S.Naturals=i(K,"\\mathbb{N}","&#8469;"),S.P=S.primes=S.Primes=S.projective=S.Projective=S.probability=S.Probability=i(K,"\\mathbb{P}","&#8473;"),S.Z=S.integers=S.Integers=i(K,"\\mathbb{Z}","&#8484;"),S.Q=S.rationals=S.Rationals=i(K,"\\mathbb{Q}","&#8474;"),S.R=S.reals=S.Reals=i(K,"\\mathbb{R}","&#8477;"),S.C=S.complex=S.Complex=S.complexes=S.Complexes=S.complexplane=S.Complexplane=S.ComplexPlane=i(K,"\\mathbb{C}","&#8450;"),S.H=S.Hamiltonian=S.quaternions=S.Quaternions=i(K,"\\mathbb{H}","&#8461;"),S.quad=S.emsp=i(K,"\\quad ","    "),S.qquad=i(K,"\\qquad ","        "),S.diamond=i(K,"\\diamond ","&#9671;"),S.bigtriangleup=i(K,"\\bigtriangleup ","&#9651;"),S.ominus=i(K,"\\ominus ","&#8854;"),S.uplus=i(K,"\\uplus ","&#8846;"),S.bigtriangledown=i(K,"\\bigtriangledown ","&#9661;"),S.sqcap=i(K,"\\sqcap ","&#8851;"),S.triangleleft=i(K,"\\triangleleft ","&#8882;"),S.sqcup=i(K,"\\sqcup ","&#8852;"),S.triangleright=i(K,"\\triangleright ","&#8883;"),S.odot=S.circledot=i(K,"\\odot ","&#8857;"),S.bigcirc=i(K,"\\bigcirc ","&#9711;"),S.dagger=i(K,"\\dagger ","&#0134;"),S.ddagger=i(K,"\\ddagger ","&#135;"),S.wr=i(K,"\\wr ","&#8768;"),S.amalg=i(K,"\\amalg ","&#8720;"),S.models=i(K,"\\models ","&#8872;"),S.prec=i(K,"\\prec ","&#8826;"),S.succ=i(K,"\\succ ","&#8827;"),S.preceq=i(K,"\\preceq ","&#8828;"),S.succeq=i(K,"\\succeq ","&#8829;"),S.simeq=i(K,"\\simeq ","&#8771;"),S.mid=i(K,"\\mid ","&#8739;"),S.ll=i(K,"\\ll ","&#8810;"),S.gg=i(K,"\\gg ","&#8811;"),S.parallel=i(K,"\\parallel ","&#8741;"),S.nparallel=i(K,"\\nparallel ","&#8742;"),S.bowtie=i(K,"\\bowtie ","&#8904;"),S.sqsubset=i(K,"\\sqsubset ","&#8847;"),S.sqsupset=i(K,"\\sqsupset ","&#8848;"),S.smile=i(K,"\\smile ","&#8995;"),S.sqsubseteq=i(K,"\\sqsubseteq ","&#8849;"),S.sqsupseteq=i(K,"\\sqsupseteq ","&#8850;"),S.doteq=i(K,"\\doteq ","&#8784;"),S.frown=i(K,"\\frown ","&#8994;"),S.vdash=i(K,"\\vdash ","&#8870;"),S.dashv=i(K,"\\dashv ","&#8867;"),S.nless=i(K,"\\nless ","&#8814;"),S.ngtr=i(K,"\\ngtr ","&#8815;"),S.longleftarrow=i(K,"\\longleftarrow ","&#8592;"),S.longrightarrow=i(K,"\\longrightarrow ","&#8594;"),S.Longleftarrow=i(K,"\\Longleftarrow ","&#8656;"),S.Longrightarrow=i(K,"\\Longrightarrow ","&#8658;"),S.longleftrightarrow=i(K,"\\longleftrightarrow ","&#8596;"),S.updownarrow=i(K,"\\updownarrow ","&#8597;"),S.Longleftrightarrow=i(K,"\\Longleftrightarrow ","&#8660;"),S.Updownarrow=i(K,"\\Updownarrow ","&#8661;"),S.mapsto=i(K,"\\mapsto ","&#8614;"),S.nearrow=i(K,"\\nearrow ","&#8599;"),S.hookleftarrow=i(K,"\\hookleftarrow ","&#8617;"),S.hookrightarrow=i(K,"\\hookrightarrow ","&#8618;"),S.searrow=i(K,"\\searrow ","&#8600;"),S.leftharpoonup=i(K,"\\leftharpoonup ","&#8636;"),S.rightharpoonup=i(K,"\\rightharpoonup ","&#8640;"),S.swarrow=i(K,"\\swarrow ","&#8601;"),S.leftharpoondown=i(K,"\\leftharpoondown ","&#8637;"),S.rightharpoondown=i(K,"\\rightharpoondown ","&#8641;"),S.nwarrow=i(K,"\\nwarrow ","&#8598;"),S.ldots=i(K,"\\ldots ","&#8230;"),S.cdots=i(K,"\\cdots ","&#8943;"),S.vdots=i(K,"\\vdots ","&#8942;"),S.ddots=i(K,"\\ddots ","&#8945;"),S.surd=i(K,"\\surd ","&#8730;"),S.triangle=i(K,"\\triangle ","&#9651;"),S.ell=i(K,"\\ell ","&#8467;"),S.top=i(K,"\\top ","&#8868;"),S.flat=i(K,"\\flat ","&#9837;"),S.natural=i(K,"\\natural ","&#9838;"),S.sharp=i(K,"\\sharp ","&#9839;"),S.wp=i(K,"\\wp ","&#8472;"),S.bot=i(K,"\\bot ","&#8869;"),S.clubsuit=i(K,"\\clubsuit ","&#9827;"),S.diamondsuit=i(K,"\\diamondsuit ","&#9826;"),S.heartsuit=i(K,"\\heartsuit ","&#9825;"),S.spadesuit=i(K,"\\spadesuit ","&#9824;"),S.parallelogram=i(K,"\\parallelogram ","&#9649;"),S.square=i(K,"\\square ","&#11036;"),S.oint=i(K,"\\oint ","&#8750;"),S.bigcap=i(K,"\\bigcap ","&#8745;"),S.bigcup=i(K,"\\bigcup ","&#8746;"),S.bigsqcup=i(K,"\\bigsqcup ","&#8852;"),S.bigvee=i(K,"\\bigvee ","&#8744;"),S.bigwedge=i(K,"\\bigwedge ","&#8743;"),S.bigodot=i(K,"\\bigodot ","&#8857;"),S.bigotimes=i(K,"\\bigotimes ","&#8855;"),S.bigoplus=i(K,"\\bigoplus ","&#8853;"),S.biguplus=i(K,"\\biguplus ","&#8846;"),S.lfloor=i(K,"\\lfloor ","&#8970;"),S.rfloor=i(K,"\\rfloor ","&#8971;"),S.lceil=i(K,"\\lceil ","&#8968;"),S.rceil=i(K,"\\rceil ","&#8969;"),S.opencurlybrace=S.lbrace=i(K,"\\lbrace ","{"),S.closecurlybrace=S.rbrace=i(K,"\\rbrace ","}"),S.lbrack=i(K,"["),S.rbrack=i(K,"]"),S.slash=i(K,"/"),S.vert=i(K,"|"),S.perp=S.perpendicular=i(K,"\\perp ","&perp;"),S.nabla=S.del=i(K,"\\nabla ","&nabla;"),S.hbar=i(K,"\\hbar ","&#8463;"),S.AA=S.Angstrom=S.angstrom=i(K,"\\text\\AA ","&#8491;"),S.ring=S.circ=S.circle=i(K,"\\circ ","&#8728;"),S.bull=S.bullet=i(K,"\\bullet ","&bull;"),S.setminus=S.smallsetminus=i(K,"\\setminus ","&#8726;"),S.not=S["¬"]=S.neg=i(K,"\\neg ","&not;"),S["…"]=S.dots=S.ellip=S.hellip=S.ellipsis=S.hellipsis=i(K,"\\dots ","&hellip;"),S.converges=S.darr=S.dnarr=S.dnarrow=S.downarrow=i(K,"\\downarrow ","&darr;"),S.dArr=S.dnArr=S.dnArrow=S.Downarrow=i(K,"\\Downarrow ","&dArr;"),S.diverges=S.uarr=S.uparrow=i(K,"\\uparrow ","&uarr;"),S.uArr=S.Uparrow=i(K,"\\Uparrow ","&uArr;"),S.to=i(Y,"\\to ","&rarr;"),S.rarr=S.rightarrow=i(K,"\\rightarrow ","&rarr;"),S.implies=i(Y,"\\Rightarrow ","&rArr;"),S.rArr=S.Rightarrow=i(K,"\\Rightarrow ","&rArr;"),S.gets=i(Y,"\\gets ","&larr;"),S.larr=S.leftarrow=i(K,"\\leftarrow ","&larr;"),S.impliedby=i(Y,"\\Leftarrow ","&lArr;"),S.lArr=S.Leftarrow=i(K,"\\Leftarrow ","&lArr;"),S.harr=S.lrarr=S.leftrightarrow=i(K,"\\leftrightarrow ","&harr;"),S.iff=i(Y,"\\Leftrightarrow ","&hArr;"),S.hArr=S.lrArr=S.Leftrightarrow=i(K,"\\Leftrightarrow ","&hArr;"),S.Re=S.Real=S.real=i(K,"\\Re ","&real;"),S.Im=S.imag=S.image=S.imagin=S.imaginary=S.Imaginary=i(K,"\\Im ","&image;"),S.part=S.partial=i(K,"\\partial ","&part;"),S.infty=S.infin=S.infinity=i(K,"\\infty ","&infin;"),S.alef=S.alefsym=S.aleph=S.alephsym=i(K,"\\aleph ","&alefsym;"),S.xist=S.xists=S.exist=S.exists=i(K,"\\exists ","&exist;"),S.nexists=S.nexist=i(K,"\\nexists ","&#8708;"),S.and=S.land=S.wedge=i(K,"\\wedge ","&and;"),S.or=S.lor=S.vee=i(K,"\\vee ","&or;"),S.o=S.O=S.empty=S.emptyset=S.oslash=S.Oslash=S.nothing=S.varnothing=i(Y,"\\varnothing ","&empty;"),S.cup=S.union=i(Y,"\\cup ","&cup;"),S.cap=S.intersect=S.intersection=i(Y,"\\cap ","&cap;"),S.deg=S.degree=i(K,"\\degree ","&deg;"),S.ang=S.angle=i(K,"\\angle ","&ang;"),S.measuredangle=i(K,"\\measuredangle ","&#8737;");var V=x(K,function(t,e){t.createLeftOf=function(t){t.options.autoSubscriptNumerals&&t.parent!==t.parent.parent.sub&&(t[O]instanceof J&&t[O].isItalic!==!1||t[O]instanceof yt&&t[O][O]instanceof J&&t[O][O].isItalic!==!1)?(S._().createLeftOf(t),e.createLeftOf.call(this,t),t.insRightOf(t.parent.parent)):e.createLeftOf.call(this,t)}}),J=x(G,function(t,e){t.init=function(t,n){e.init.call(this,t,"<var>"+(n||t)+"</var>")},t.text=function(){var t=this.ctrlSeq;return!this[O]||this[O]instanceof J||this[O]instanceof Y||"\\ "===this[O].ctrlSeq||(t="*"+t),!this[k]||this[k]instanceof Y||this[k]instanceof yt||(t+="*"),t}});I.p.autoCommands={_maxLength:0},z.autoCommands=function(t){if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(var e=t.split(" "),n={},i=0,r=0;r<e.length;r+=1){var s=e[r];if(s.length<2)throw'autocommand "'+s+'" not minimum length of 2';if(S[s]===rt)throw'"'+s+'" is a built-in operator name';n[s]=1,i=w(i,s.length)}return n._maxLength=i,n};var tt=x(J,function(t,e){function n(t){return!t||t instanceof Y||t instanceof xt}t.init=function(t){return e.init.call(this,this.letter=t)},t.createLeftOf=function(t){e.createLeftOf.apply(this,arguments);var n=t.options.autoCommands,i=n._maxLength;if(i>0){for(var r="",s=this,o=0;s instanceof tt&&s.ctrlSeq===s.letter&&o<i;)r=s.letter+r,s=s[O],o+=1;for(;r.length;){if(n.hasOwnProperty(r)){for(var o=1,s=this;o<r.length;o+=1,s=s[O]);return T(s,this).remove(),t[O]=s[O],S[r](r).createLeftOf(t)}r=r.slice(1)}}},t.italicize=function(t){return this.isItalic=t,this.jQ.toggleClass("mq-operator-name",!t),this},t.finalizeTree=t.siblingDeleted=t.siblingCreated=function(t,e){e!==O&&this[k]instanceof tt||this.autoUnItalicize(t)},t.autoUnItalicize=function(t){var e=t.autoOperatorNames;if(0!==e._maxLength){for(var i=this.letter,r=this[O];r instanceof tt;r=r[O])i=r.letter+i;for(var s=this[k];s instanceof tt;s=s[k])i+=s.letter;T(r[k]||this.parent.ends[O],s[O]||this.parent.ends[k]).each(function(t){t.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),t.ctrlSeq=t.letter});t:for(var o=0,a=r[k]||this.parent.ends[O];o<i.length;o+=1,a=a[k])for(var l=b(e._maxLength,i.length-o);l>0;l-=1){var c=i.slice(o,o+l);if(e.hasOwnProperty(c)){for(var u=0,h=a;u<l;u+=1,h=h[k]){h.italicize(!1);var f=h}var p=et.hasOwnProperty(c);if(a.ctrlSeq=(p?"\\":"\\operatorname{")+a.ctrlSeq,f.ctrlSeq+=p?" ":"}",it.hasOwnProperty(c)&&f[O][O][O].jQ.addClass("mq-last"),n(a[O])||a.jQ.addClass("mq-first"),!n(f[k]))if(f[k]instanceof yt){var d=f[k],m=d.siblingCreated=d.siblingDeleted=function(){d.jQ.toggleClass("mq-after-operator-name",!(d[k]instanceof Ct))};m()}else f.jQ.toggleClass("mq-last",!(f[k]instanceof Ct));o+=l-1,a=f;continue t}}}}}),et={},nt=I.p.autoOperatorNames={_maxLength:9},it={limsup:1,liminf:1,projlim:1,injlim:1};!function(){for(var t="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" "),e=0;e<t.length;e+=1)et[t[e]]=nt[t[e]]=1;for(var n="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" "),e=0;e<n.length;e+=1)et[n[e]]=1;for(var i="sin cos tan sec cosec csc cotan cot ctg".split(" "),e=0;e<i.length;e+=1)nt[i[e]]=nt["arc"+i[e]]=nt[i[e]+"h"]=nt["ar"+i[e]+"h"]=nt["arc"+i[e]+"h"]=1;for(var r="gcf hcf lcm proj span".split(" "),e=0;e<r.length;e+=1)nt[r[e]]=1}(),z.autoOperatorNames=function(t){if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(var e=t.split(" "),n={},i=0,r=0;r<e.length;r+=1){var s=e[r];if(s.length<2)throw'"'+s+'" not minimum length of 2';n[s]=1,i=w(i,s.length)}return n._maxLength=i,n};var rt=x(G,function(t,e){t.init=function(t){this.ctrlSeq=t},t.createLeftOf=function(t){for(var e=this.ctrlSeq,n=0;n<e.length;n+=1)tt(e.charAt(n)).createLeftOf(t)},t.parser=function(){for(var t=this.ctrlSeq,e=X(),n=0;n<t.length;n+=1)tt(t.charAt(n)).adopt(e,e.ends[k],0);return $.succeed(e.children())}});for(var st in nt)nt.hasOwnProperty(st)&&(S[st]=rt);S.operatorname=x(W,function(e){e.createLeftOf=t,e.numBlocks=function(){return 1},e.parser=function(){return U.block.map(function(t){return t.children()})}}),S.f=x(tt,function(t,e){t.init=function(){G.p.init.call(this,this.letter="f",'<var class="mq-f">f</var>')},t.italicize=function(t){return this.jQ.html("f").toggleClass("mq-f",t),e.italicize.apply(this,arguments)}}),S[" "]=S.space=i(K,"\\ ","&nbsp;"),S["'"]=S.prime=i(K,"'","&prime;"),S.backslash=i(K,"\\backslash ","\\"),D["\\"]||(D["\\"]=S.backslash),S.$=i(K,"\\$","$");var ot=x(G,function(t,e){t.init=function(t,n){e.init.call(this,t,'<span class="mq-nonSymbola">'+(n||t)+"</span>")}});S["@"]=ot,S["&"]=i(ot,"\\&","&amp;"),S["%"]=i(ot,"\\%","%"),S.alpha=S.beta=S.gamma=S.delta=S.zeta=S.eta=S.theta=S.iota=S.kappa=S.mu=S.nu=S.xi=S.rho=S.sigma=S.tau=S.chi=S.psi=S.omega=x(J,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),S.phi=i(J,"\\phi ","&#981;"),S.phiv=S.varphi=i(J,"\\varphi ","&phi;"),S.epsilon=i(J,"\\epsilon ","&#1013;"),S.epsiv=S.varepsilon=i(J,"\\varepsilon ","&epsilon;"),S.piv=S.varpi=i(J,"\\varpi ","&piv;"),S.sigmaf=S.sigmav=S.varsigma=i(J,"\\varsigma ","&sigmaf;"),S.thetav=S.vartheta=S.thetasym=i(J,"\\vartheta ","&thetasym;"),S.upsilon=S.upsi=i(J,"\\upsilon ","&upsilon;"),S.gammad=S.Gammad=S.digamma=i(J,"\\digamma ","&#989;"),S.kappav=S.varkappa=i(J,"\\varkappa ","&#1008;"),S.rhov=S.varrho=i(J,"\\varrho ","&#1009;"),S.pi=S["π"]=i(ot,"\\pi ","&pi;"),S.lambda=i(ot,"\\lambda ","&lambda;"),S.Upsilon=S.Upsi=S.upsih=S.Upsih=i(G,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),S.Gamma=S.Delta=S.Theta=S.Lambda=S.Xi=S.Pi=S.Sigma=S.Phi=S.Psi=S.Omega=S.forall=x(K,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}});var at=x(W,function(t){t.init=function(t){this.latex=t},t.createLeftOf=function(t){var e=U.parse(this.latex);e.children().adopt(t.parent,t[O],t[k]),t[O]=e.ends[k],e.jQize().insertBefore(t.jQ),e.finalizeInsert(t.options,t),e.ends[k][k].siblingCreated&&e.ends[k][k].siblingCreated(t.options,O),e.ends[O][O].siblingCreated&&e.ends[O][O].siblingCreated(t.options,k),t.parent.bubble("reflow")},t.parser=function(){var t=U.parse(this.latex).children();return $.succeed(t)}});S["¹"]=i(at,"^1"),S["²"]=i(at,"^2"),S["³"]=i(at,"^3"),S["¼"]=i(at,"\\frac14"),S["½"]=i(at,"\\frac12"),S["¾"]=i(at,"\\frac34");var lt=x(Y,function(t){t.init=K.prototype.init,t.contactWeld=t.siblingCreated=t.siblingDeleted=function(t,e){if(e!==k)return this.jQ[0].className=!this[O]||this[O]instanceof Y||/^[,;:\(\[]$/.test(this[O].ctrlSeq)?"":"mq-binary-operator",this}});S["+"]=i(lt,"+","+"),S["–"]=S["-"]=i(lt,"-","&minus;"),S["±"]=S.pm=S.plusmn=S.plusminus=i(lt,"\\pm ","&plusmn;"),S.mp=S.mnplus=S.minusplus=i(lt,"\\mp ","&#8723;"),D["*"]=S.sdot=S.cdot=i(Y,"\\cdot ","&middot;","*");var ct=x(Y,function(t,e){t.init=function(t,n){this.data=t,this.strict=n;var i=n?"Strict":"";e.init.call(this,t["ctrlSeq"+i],t["html"+i],t["text"+i])},t.swap=function(t){this.strict=t;var e=t?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+e],this.jQ.html(this.data["html"+e]),this.textTemplate=[this.data["text"+e]]},t.deleteTowards=function(t,n){return t!==O||this.strict?void e.deleteTowards.apply(this,arguments):(this.swap(!0),void this.bubble("reflow"))}}),ut={ctrlSeq:"\\le ",html:"&le;",text:"≤",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},ht={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"};S["<"]=S.lt=i(ct,ut,!0),S[">"]=S.gt=i(ct,ht,!0),S["≤"]=S.le=S.leq=i(ct,ut,!1),S["≥"]=S.ge=S.geq=i(ct,ht,!1);var ft=x(Y,function(t,e){t.init=function(){e.init.call(this,"=","=")},t.createLeftOf=function(t){return t[O]instanceof ct&&t[O].strict?(t[O].swap(!1),void t[O].bubble("reflow")):void e.createLeftOf.apply(this,arguments)}});S["="]=ft,S["×"]=S.times=i(Y,"\\times ","&times;","[x]"),S["÷"]=S.div=S.divide=S.divides=i(Y,"\\div ","&divide;","[/]"),D["~"]=S.sim=i(Y,"\\sim ","~","~");var pt,dt,mt=t,gt=document.createElement("div"),vt=gt.style,bt={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(var wt in bt)if(wt in vt){dt=wt;break}dt?pt=function(t,e,n){t.css(dt,"scale("+e+","+n+")")}:"filter"in vt?(mt=function(t){t.className=t.className},pt=function(t,e,n){function i(){t.css("marginRight",(r.width()-1)*(e-1)/e+"px")}e/=1+(n-1)/2,t.css("fontSize",n+"em"),t.hasClass("mq-matrixed-container")||t.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>');var r=t.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+e+",SizingMethod='auto expand')");i();var s=setInterval(i);j(window).load(function(){clearTimeout(s),i()})}):pt=function(t,e,n){t.css("fontSize",n+"em")};var qt=x(W,function(t,e){t.init=function(t,n,i){e.init.call(this,t,"<"+n+" "+i+">&0</"+n+">")}});S.mathrm=i(qt,"\\mathrm","span",'class="mq-roman mq-font"'),S.mathit=i(qt,"\\mathit","i",'class="mq-font"'),S.mathbf=i(qt,"\\mathbf","b",'class="mq-font"'),S.mathsf=i(qt,"\\mathsf","span",'class="mq-sans-serif mq-font"'),S.mathtt=i(qt,"\\mathtt","span",'class="mq-monospace mq-font"'),S.underline=i(qt,"\\underline","span",'class="mq-non-leaf mq-underline"'),S.overline=S.bar=i(qt,"\\overline","span",'class="mq-non-leaf mq-overline"'),S.overrightarrow=i(qt,"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),S.overleftarrow=i(qt,"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"');var yt=(S.textcolor=x(W,function(t,e){t.setColor=function(t){this.color=t,this.htmlTemplate='<span class="mq-textcolor" style="color:'+t+'">&0</span>'},t.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},t.parser=function(){var t=this,n=$.optWhitespace,i=$.string,r=$.regex;return n.then(i("{")).then(r(/^[#\w\s.,()%-]*/)).skip(i("}")).then(function(n){return t.setColor(n),e.parser.call(t)})}}),S.class=x(W,function(t,e){t.parser=function(){var t=this,n=$.string,i=$.regex;return $.optWhitespace.then(n("{")).then(i(/^[-\w\s\\\xA0-\xFF]*/)).skip(n("}")).then(function(n){return t.htmlTemplate='<span class="mq-class '+n+'">&0</span>',e.parser.call(t)})}}),x(W,function(t,e){t.ctrlSeq="_{...}^{...}",t.createLeftOf=function(t){if(t[O]||!t.options.supSubsRequireOperand)return e.createLeftOf.apply(this,arguments)},t.contactWeld=function(t){for(var e=O;e;e=e===O&&k)if(this[e]instanceof yt){for(var n="sub";n;n="sub"===n&&"sup"){var i=this[n],r=this[e][n];if(i){if(r)if(i.isEmpty())var s=Q(r,0,r.ends[O]);else{i.jQ.children().insAtDirEnd(-e,r.jQ);var o=i.children().disown(),s=Q(r,o.ends[k],r.ends[O]);e===O?o.adopt(r,r.ends[k],0):o.adopt(r,0,r.ends[O])}else this[e].addBlock(i.disown());this.placeCursor=function(t,n){return function(i){i.insAtDirEnd(-e,t||n)}}(r,i)}}this.remove(),t&&t[O]===this&&(e===k&&s?s[O]?t.insRightOf(s[O]):t.insAtLeftEnd(s.parent):t.insRightOf(this[e]));break}this.respace()},I.p.charsThatBreakOutOfSupSub="",t.finalizeTree=function(){this.ends[O].write=function(t,e){if(t.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===e)return;var n=this.chToCmd(e);return n instanceof G?t.deleteSelection():t.clearSelection().insRightOf(this.parent),n.createLeftOf(t.show())}t[O]&&!t[k]&&!t.selection&&t.options.charsThatBreakOutOfSupSub.indexOf(e)>-1&&t.insRightOf(this.parent),X.p.write.apply(this,arguments)}},t.moveTowards=function(t,n,i){n.options.autoSubscriptNumerals&&!this.sup?n.insDirOf(t,this):e.moveTowards.apply(this,arguments)},t.deleteTowards=function(t,n){if(n.options.autoSubscriptNumerals&&this.sub){var i=this.sub.ends[-t];i instanceof G?i.remove():i&&i.deleteTowards(t,n.insAtDirEnd(-t,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(O,n.insAtLeftEnd(this.sub)),this.sup&&n.insDirOf(-t,this))}else e.deleteTowards.apply(this,arguments)},t.latex=function(){function t(t,e){var n=e&&e.latex();return e?t+(1===n.length?n:"{"+(n||" ")+"}"):""}return t("_",this.sub)+t("^",this.sup)},t.respace=t.siblingCreated=t.siblingDeleted=function(t,e){e!==k&&this.jQ.toggleClass("mq-limit","\\int "===this[O].ctrlSeq)},t.addBlock=function(t){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=t,t.adopt(this,this.sub,0).downOutOf=this.sub,t.jQ=j('<span class="mq-sup"/>').append(t.jQ.children()).attr(v,t.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=t,t.adopt(this,0,this.sup).upOutOf=this.sup,t.jQ=j('<span class="mq-sub"></span>').append(t.jQ.children()).attr(v,t.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(var e=0;e<2;e+=1)(function(t,e,n,i){t[e].deleteOutOf=function(r,s){if(s.insDirOf(this[r]?-r:r,this.parent),!this.isEmpty()){var o=this.ends[r];this.children().disown().withDirAdopt(r,s.parent,s[r],s[-r]).jQ.insDirOf(-r,s.jQ),s[-r]=o}t.supsub=n,delete t[e],delete t[i+"Into"],t[n][i+"OutOf"]=h,delete t[n].deleteOutOf,"sub"===e&&j(t.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}})(this,"sub sup".split(" ")[e],"sup sub".split(" ")[e],"down up".split(" ")[e])}}));S.subscript=S._=x(yt,function(t,e){t.supsub="sub",t.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["_"],t.finalizeTree=function(){this.downInto=this.sub=this.ends[O],this.sub.upOutOf=h,e.finalizeTree.call(this)}}),S.superscript=S.supscript=S["^"]=x(yt,function(t,e){t.supsub="sup",t.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',t.textTemplate=["^"],t.finalizeTree=function(){this.upInto=this.sup=this.ends[k],this.sup.downOutOf=h,e.finalizeTree.call(this)}});var xt=x(W,function(t,e){t.init=function(t,e){var n='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+e+'</big><span class="mq-from"><span>&0</span></span></span>';G.prototype.init.call(this,t,n)},t.createLeftOf=function(t){e.createLeftOf.apply(this,arguments),t.options.sumStartsWithNEquals&&(tt("n").createLeftOf(t),ft().createLeftOf(t))},t.latex=function(){function t(t){return 1===t.length?t:"{"+(t||" ")+"}"}return this.ctrlSeq+"_"+t(this.ends[O].latex())+"^"+t(this.ends[k].latex())},t.parser=function(){for(var t=$.string,e=$.optWhitespace,n=$.succeed,i=U.block,r=this,s=r.blocks=[X(),X()],o=0;o<s.length;o+=1)s[o].adopt(r,r.ends[k],0);return e.then(t("_").or(t("^"))).then(function(t){var e=s["_"===t?0:1];return i.then(function(t){return t.children().adopt(e,e.ends[k],0),n(r)})}).many().result(r)},t.finalizeTree=function(){this.downInto=this.ends[O],this.upInto=this.ends[k],this.ends[O].upOutOf=this.ends[k],this.ends[k].downOutOf=this.ends[O]}});S["∑"]=S.sum=S.summation=i(xt,"\\sum ","&sum;"),S["∏"]=S.prod=S.product=i(xt,"\\prod ","&prod;"),S.coprod=S.coproduct=i(xt,"\\coprod ","&#8720;"),S["∫"]=S.int=S.integral=i(G,"\\int ","<big>&int;</big>");var Ot=S.frac=S.dfrac=S.cfrac=S.fraction=x(W,function(t,e){t.ctrlSeq="\\frac",t.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["(",")/(",")"],t.finalizeTree=function(){this.upInto=this.ends[k].upOutOf=this.ends[O],this.downInto=this.ends[O].downOutOf=this.ends[k]}}),kt=S.over=D["/"]=x(Ot,function(e,n){e.createLeftOf=function(e){if(!this.replacedFragment){for(var i=e[O];i&&!(i instanceof Y||i instanceof(S.text||t)||i instanceof xt||"\\ "===i.ctrlSeq||/^[,;:]$/.test(i.ctrlSeq));)i=i[O];i instanceof xt&&i[k]instanceof yt&&(i=i[k],i[k]instanceof yt&&i[k].ctrlSeq!=i.ctrlSeq&&(i=i[k])),i!==e[O]&&(this.replaces(T(i[k]||e.parent.ends[O],e[O])),e[O]=i)}n.createLeftOf.call(this,e)}}),jt=S.sqrt=S["√"]=x(W,function(t,e){t.ctrlSeq="\\sqrt",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',t.textTemplate=["sqrt(",")"],t.parser=function(){return U.optBlock.then(function(t){return U.block.map(function(e){var n=Qt();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(e.parser.call(this))},t.reflow=function(){var t=this.ends[k].jQ;pt(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}}),Qt=(S.vec=x(W,function(t,e){t.ctrlSeq="\\vec",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-vector-prefix">&rarr;</span><span class="mq-vector-stem">&0</span></span>',t.textTemplate=["vec(",")"]}),S.nthroot=x(jt,function(t,e){t.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',t.textTemplate=["sqrt[","](",")"],t.latex=function(){return"\\sqrt["+this.ends[O].latex()+"]{"+this.ends[k].latex()+"}"}})),Ct=x(x(W,f),function(e,n){e.init=function(t,e,i,r,s){n.init.call(this,"\\left"+r,d,[e,i]),this.side=t,this.sides={},this.sides[O]={ch:e,ctrlSeq:r},this.sides[k]={ch:i,ctrlSeq:s}},e.numBlocks=function(){return 1},e.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(this.side===k?" mq-ghost":"")+'">'+this.sides[O].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===O?" mq-ghost":"")+'">'+this.sides[k].ch+"</span></span>",n.html.call(this)},e.latex=function(){return"\\left"+this.sides[O].ctrlSeq+this.ends[O].latex()+"\\right"+this.sides[k].ctrlSeq},e.oppBrack=function(t,e,n){return e instanceof Ct&&e.side&&e.side!==-n&&("|"===this.sides[this.side].ch||e.side===-this.side)&&(!t.restrictMismatchedBrackets||Tt[this.sides[this.side].ch]===e.sides[e.side].ch||{"(":"]","[":")"}[this.sides[O].ch]===e.sides[k].ch)&&e},e.closeOpposing=function(t){t.side=0,t.sides[this.side]=this.sides[this.side],t.delimjQs.eq(this.side===O?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},e.createLeftOf=function(t){if(!this.replacedFragment)var e=t.options,i=this.oppBrack(e,t[O],O)||this.oppBrack(e,t[k],k)||this.oppBrack(e,t.parent.parent);if(i){var r=this.side=-i.side;this.closeOpposing(i),i===t.parent.parent&&t[r]&&(T(t[r],t.parent.ends[r],-r).disown().withDirAdopt(-r,i.parent,i,i[r]).jQ.insDirOf(r,i.jQ),i.bubble("reflow"))}else i=this,r=i.side,i.replacedFragment?i.side=0:t[-r]&&(i.replaces(T(t[-r],t.parent.ends[-r],r)),t[-r]=0),n.createLeftOf.call(i,t);r===O?t.insAtLeftEnd(i.ends[O]):t.insRightOf(i)},e.placeCursor=t,e.unwrap=function(){this.ends[O].children().disown().adopt(this.parent,this,this[k]).jQ.insertAfter(this.jQ),this.remove()},e.deleteSide=function(t,e,n){var i=this.parent,r=this[t],s=i.ends[t];if(t===this.side)return this.unwrap(),void(r?n.insDirOf(-t,r):n.insAtDirEnd(t,i));var o=n.options,a=!this.side;if(this.side=-t,this.oppBrack(o,this.ends[O].ends[this.side],t)){this.closeOpposing(this.ends[O].ends[this.side]);var l=this.ends[O].ends[t];this.unwrap(),l.siblingCreated&&l.siblingCreated(n.options,t),r?n.insDirOf(-t,r):n.insAtDirEnd(t,i)}else{if(this.oppBrack(o,this.parent.parent,t))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(e&&a)return this.unwrap(),void(r?n.insDirOf(-t,r):n.insAtDirEnd(t,i));this.sides[t]={ch:Tt[this.sides[this.side].ch],ctrlSeq:Tt[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(t===O?0:1).addClass("mq-ghost").html(this.sides[t].ch)}if(r){var l=this.ends[O].ends[t];T(r,s,-t).disown().withDirAdopt(-t,this.ends[O],l,0).jQ.insAtDirEnd(t,this.ends[O].jQ.removeClass("mq-empty")),l.siblingCreated&&l.siblingCreated(n.options,t),n.insDirOf(-t,r)}else e?n.insDirOf(t,this):n.insAtDirEnd(t,this.ends[O])}},e.deleteTowards=function(t,e){this.deleteSide(-t,!1,e)},e.finalizeTree=function(){this.ends[O].deleteOutOf=function(t,e){this.parent.deleteSide(t,!0,e)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===O?1:0).removeClass("mq-ghost"),this.side=0}},e.siblingCreated=function(t,e){e===-this.side&&this.finalizeTree()}}),Tt={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|"};p("("),p("["),p("{","\\{"),S.langle=i(Ct,O,"&lang;","&rang;","\\langle ","\\rangle "),S.rangle=i(Ct,k,"&lang;","&rang;","\\langle ","\\rangle "),D["|"]=i(Ct,O,"|","|","|","|"),S.left=x(W,function(t){t.parser=function(){var t=$.regex,e=$.string,n=($.succeed,$.optWhitespace);return n.then(t(/^(?:[([|]|\\\{)/)).then(function(i){var r="\\"===i.charAt(0)?i.slice(1):i;return U.then(function(s){return e("\\right").skip(n).then(t(/^(?:[\])|]|\\\})/)).map(function(t){var e="\\"===t.charAt(0)?t.slice(1):t,n=Ct(0,r,e,i,t);return n.blocks=[s],s.adopt(n,0,0),n})})})}}),S.right=x(W,function(t){t.parser=function(){return $.fail("unmatched \\right")}});var St=S.binom=S.binomial=x(x(W,f),function(t,e){t.ctrlSeq="\\binom",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',t.textTemplate=["choose(",",",")"]});S.choose=x(St,function(t){t.createLeftOf=kt.prototype.createLeftOf});S.editable=S.MathQuillMathField=x(W,function(t,e){t.ctrlSeq="\\MathQuillMathField",t.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',
t.parser=function(){var t=this,n=$.string,i=$.regex,r=$.succeed;return n("[").then(i(/^[a-z][a-z0-9]*/i)).skip(n("]")).map(function(e){t.name=e}).or(r()).then(e.parser.call(t))},t.finalizeTree=function(){var t=E(this.ends[O],this.jQ,I());t.KIND_OF_MQ="MathField",t.editable=!0,t.createTextarea(),t.editablesTextareaEvents(),t.cursor.insAtRightEnd(t.root),u(t.root)},t.registerInnerField=function(t,e){t.push(t[this.name]=e(this.ends[O].controller))},t.latex=function(){return this.ends[O].latex()},t.text=function(){return this.ends[O].text()}});var Dt=S.embed=x(G,function(t,e){t.setOptions=function(t){function e(){return""}return this.text=t.text||e,this.htmlTemplate=t.htmlString||"",this.latex=t.latex||e,this},t.parser=function(){var t=this;return string=$.string,regex=$.regex,succeed=$.succeed,string("{").then(regex(/^[a-z][a-z0-9]*/i)).skip(string("}")).then(function(e){return string("[").then(regex(/^[-\w\s]*/)).skip(string("]")).or(succeed()).map(function(n){return t.setOptions(M[e](n))})})}}),_t=c(1);for(var At in _t)(function(t,e){"function"==typeof e?(l[t]=function(){return a(),e.apply(this,arguments)},l[t].prototype=e.prototype):l[t]=e})(At,_t[At])}();